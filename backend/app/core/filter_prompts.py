"""
컨텐츠 필터링을 위한 프롬프트 템플릿 모음
법적 가이드라인 준수를 위한 LLM 프롬프트들을 정의합니다.
"""

# 컨텐츠 안전성 분석 프롬프트
SAFETY_ANALYSIS_PROMPT = """
당신은 금융 조언 컨텐츠의 안전성을 평가하는 전문가입니다.

다음 컨텐츠를 분석하여 법적/윤리적 위험도를 평가하세요:

컨텐츠: "{content}"

평가 기준:
1. 투자 권유 여부 (금융투자업법 위반 가능성)
   - 구체적인 종목/상품 추천
   - "사세요", "팔아야 합니다" 등 투자 행위 유도 표현
   - 특정 시점의 매매 타이밍 지시

2. 과도한 수익 보장 표현
   - "확실한 수익", "보장된 이익" 등 과장된 표현
   - 구체적인 수익률 약속
   - 리스크 없는 투자라는 잘못된 정보

3. 리스크 경고 누락
   - 투자 위험성에 대한 언급 부족
   - 손실 가능성에 대한 경고 누락

4. 미확인 정보 제공
   - 검증되지 않은 시장 정보
   - 루머나 추측성 정보
   - 출처 불분명한 데이터

5. 법적 책임 관련
   - 투자 결정 책임 전가 가능성
   - 법적 면책 조항 누락

응답은 반드시 다음 JSON 형식으로 제공하세요:
{{
  "is_safe": true 또는 false,
  "safety_score": 0.0~1.0 사이의 점수,
  "risk_categories": ["위험 카테고리1", "위험 카테고리2"],
  "filter_reason": "필터링 이유 상세 설명",
  "suggested_alternative": "대안 표현 제안 (선택사항)"
}}

안전 점수 기준:
- 0.8~1.0: 안전 (그대로 출력 가능)
- 0.5~0.8: 주의 (일부 수정 필요)
- 0.0~0.5: 위험 (필터링 또는 대체 필요)
"""

# 컨텐츠 대체 생성 프롬프트
CONTENT_REPLACEMENT_PROMPT = """
다음 컨텐츠가 금융 법적 가이드라인에 위배되어 필터링되었습니다.

원본 컨텐츠: "{original_content}"
위험 요소: {risk_categories}
필터링 이유: "{filter_reason}"

안전하고 법적으로 적절한 대체 컨텐츠를 생성해주세요:

가이드라인:
1. 투자 권유 대신 → 정보 제공으로 변경
2. 확정적 표현 대신 → 가능성 위주 표현
3. 리스크 경고 포함
4. 법적 면책 조항 추가
5. 교육적 내용으로 변경

[답변 길이 제한 - 절대 준수]
- 답변은 정확히 **200자 이내**로 작성
- 핵심 내용만 간결하게 전달
- 불필요한 반복이나 장황한 설명 금지
- 200자 초과 시 downvote 됨

대체 컨텐츠:
"""

# 안전성 재검토 프롬프트
SAFETY_RECHECK_PROMPT = """
다음은 필터링 후 수정된 컨텐츠입니다.

수정된 컨텐츠: "{modified_content}"

이 컨텐츠가 금융 가이드라인을 준수하는지 최종 검토해주세요:

검토 항목:
1. 투자 권유 표현 제거 여부
2. 과장된 수익 표현 제거 여부  
3. 리스크 경고 포함 여부
4. 법적 면책 표현 적절성
5. 전반적인 안전성
6. 답변 길이가 200자 이내인지 확인

응답 형식:
{{
  "is_approved": true 또는 false,
  "final_safety_score": 0.0~1.0,
  "remaining_issues": ["남은 문제점들"],
  "approval_reason": "승인/거부 이유"
}}
"""

# 안전 수준별 임계값 설정
SAFETY_THRESHOLDS = {
    "strict": 0.85,  # 엄격한 기준 (금융기관 수준)
    "moderate": 0.70,  # 보통 기준 (일반적인 기준)
    "permissive": 0.55,  # 관대한 기준 (최소한의 필터링)
}

# 위험 카테고리 정의
RISK_CATEGORIES = {
    "investment_advice": "투자 권유",
    "guaranteed_profit": "수익 보장",
    "missing_risk_warning": "리스크 경고 누락",
    "unverified_information": "미확인 정보",
    "legal_liability": "법적 책임 문제",
    "market_manipulation": "시장 조작 우려",
    "excessive_confidence": "과도한 확신 표현",
}

# 대체 표현 사전
SAFE_ALTERNATIVES = {
    "사세요": "고려해보실 수 있습니다",
    "팔아야 합니다": "매도를 검토해보시기 바랍니다",
    "확실한 수익": "잠재적인 수익 가능성",
    "보장됩니다": "예상됩니다",
    "무조건": "일반적으로",
    "반드시": "대체로",
    "100% 상승": "상승 가능성",
}

# 필수 면책 조항
DISCLAIMER_TEMPLATE = """

⚠️ 투자 유의사항:
- 이 정보는 투자 권유가 아닌 참고용 정보입니다
- 모든 투자에는 원금 손실 위험이 있습니다  
- 투자 결정은 본인의 판단과 책임 하에 이루어져야 합니다
- 정확한 정보는 공식 자료를 확인하시기 바랍니다
"""
